<section class="profile">
  <mat-card>
    <mat-card-title>My profile</mat-card-title>
    <mat-card-content>
      <mat-tab-group>
        <mat-tab label="Personal info">
          <form [formGroup]="profileForm" class="form-grid" (ngSubmit)="saveProfile()">
            <mat-form-field appearance="fill">
              <mat-label>Full name</mat-label>
              <input matInput formControlName="fullName">
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" type="email">
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Gender</mat-label>
              <mat-select formControlName="gender">
                <mat-option value="">Prefer not to say</mat-option>
                <mat-option value="Male">Male</mat-option>
                <mat-option value="Female">Female</mat-option>
                <mat-option value="Other">Other</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Date of birth</mat-label>
              <input matInput [matDatepicker]="dobPicker" formControlName="dateOfBirth">
              <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
              <mat-datepicker #dobPicker></mat-datepicker>
            </mat-form-field>
            <button mat-raised-button color="primary" class="w-fit" [disabled]="profileForm.invalid">Save changes</button>
          </form>
        </mat-tab>
        <mat-tab label="Change password">
          <form [formGroup]="passwordForm" class="form-grid" (ngSubmit)="changePassword()">
            <mat-form-field appearance="fill">
              <mat-label>Current password</mat-label>
              <input matInput [type]="hideOld ? 'password' : 'text'" formControlName="oldPassword">
              <button mat-icon-button matSuffix type="button" (click)="hideOld = !hideOld" [attr.aria-label]="hideOld ? 'Show password' : 'Hide password'">
                <mat-icon>{{ hideOld ? 'visibility' : 'visibility_off' }}</mat-icon>
              </button>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>New password</mat-label>
              <input matInput [type]="hideNew ? 'password' : 'text'" formControlName="newPassword">
              <button mat-icon-button matSuffix type="button" (click)="hideNew = !hideNew" [attr.aria-label]="hideNew ? 'Show password' : 'Hide password'">
                <mat-icon>{{ hideNew ? 'visibility' : 'visibility_off' }}</mat-icon>
              </button>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Confirm new password</mat-label>
              <input matInput [type]="hideConfirm ? 'password' : 'text'" formControlName="confirmPassword">
              <button mat-icon-button matSuffix type="button" (click)="hideConfirm = !hideConfirm" [attr.aria-label]="hideConfirm ? 'Show password' : 'Hide password'">
                <mat-icon>{{ hideConfirm ? 'visibility' : 'visibility_off' }}</mat-icon>
              </button>
              <mat-error *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched">
                Passwords do not match
              </mat-error>
            </mat-form-field>
            <button mat-raised-button color="accent" class="w-fit" [disabled]="passwordForm.invalid">Update</button>
          </form>
        </mat-tab>
        <mat-tab label="My orders">
          <div *ngIf="loadingOrders" class="flex justify-center py-6">
            <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
          </div>
          <div *ngIf="!loadingOrders && !orders.length" class="empty">No orders yet.</div>
          <mat-accordion *ngIf="orders.length">
            <mat-expansion-panel *ngFor="let order of orders">
              <mat-expansion-panel-header>
                <mat-panel-title>Order #{{ order.id }}</mat-panel-title>
                <mat-panel-description>{{ order.status }} • {{ order.createdAt | date:'medium' }}</mat-panel-description>
              </mat-expansion-panel-header>
              <div class="order-items">
                <div class="item" *ngFor="let item of order.items">
                  <img [src]="item.imageUrl" [alt]="item.productName">
                  <div>
                    <h4>{{ item.productName }}</h4>
                    <p>Qty {{ item.quantity }} • € {{ item.priceAtPurchase | number:'1.2-2' }}</p>
                  </div>
                </div>
              </div>
              <p class="total">Total: € {{ order.totalPrice | number:'1.2-2' }}</p>
            </mat-expansion-panel>
          </mat-accordion>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</section>
